/* =============================================
   Critical CSS - Above-the-fold styles
   Критические стили для контента выше сгиба
   ============================================= */

/* EN: Focus visible styles | RU: Стили видимого фокуса */
:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
}

:focus:not(:focus-visible) {
  outline: none;
}

/* EN: Skip link styles | RU: Стили skip-ссылки */
.skip-link {
  position: fixed;
  top: -100px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--primary);
  color: #fff;
  padding: 0.75rem 1.5rem;
  font-weight: 600;
  font-size: 0.9rem;
  border-radius: 0 0 8px 8px;
  z-index: 9999;
  transition: top 0.3s ease;
  text-decoration: none;
}

.skip-link:focus {
  top: 0;
}

/* EN: Visually hidden utility | RU: Визуально скрытый элемент */
.visually-hidden,
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* EN: Button focus states | RU: Состояния фокуса кнопок */
.btn:focus-visible {
  outline: 2px solid #fff;
  outline-offset: 2px;
  box-shadow: 0 0 0 4px var(--primary);
}

.btn.ghost:focus-visible {
  outline-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(var(--primary-rgb) / 0.25);
}

/* EN: Form field focus | RU: Фокус полей форм */
input:focus-visible,
select:focus-visible,
textarea:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 0;
  border-color: var(--primary);
}

/* EN: Link focus | RU: Фокус ссылок */
a:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 3px;
  border-radius: 2px;
}

/* EN: Card focus | RU: Фокус карточек */
.post-card:focus-visible,
.review-slide:focus-visible,
.faq__trigger:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 4px;
}

/* EN: Navigation focus | RU: Фокус навигации */
.main-nav a:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 4px;
  border-radius: 4px;
}

/* EN: Theme toggle focus | RU: Фокус переключателя темы */
#themeToggle:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 4px;
  border-radius: 50%;
}

/* EN: Image skeleton loading | RU: Скелетон загрузки изображений */
.skeleton {
  background: linear-gradient(
    90deg,
    rgba(var(--ink-rgb) / 0.08) 25%,
    rgba(var(--ink-rgb) / 0.15) 50%,
    rgba(var(--ink-rgb) / 0.08) 75%
  );
  background-size: 200% 100%;
  animation: skeleton-shimmer 1.5s ease-in-out infinite;
}

@keyframes skeleton-shimmer {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}

/* EN: Image placeholder | RU: Placeholder изображений */
.img-placeholder {
  position: relative;
  overflow: hidden;
  background: rgba(var(--ink-rgb) / 0.05);
}

.img-placeholder::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    90deg,
    transparent 0%,
    rgba(255, 255, 255, 0.1) 50%,
    transparent 100%
  );
  background-size: 200% 100%;
  animation: skeleton-shimmer 1.5s ease-in-out infinite;
}

.img-placeholder img {
  opacity: 0;
  transition: opacity 0.4s ease;
}

.img-placeholder img.loaded,
.img-placeholder img[data-loaded='true'] {
  opacity: 1;
}

/* EN: Mobile menu backdrop | RU: Backdrop мобильного меню */
.nav-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  -webkit-backdrop-filter: blur(4px);
  backdrop-filter: blur(4px);
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 0.3s ease,
    visibility 0.3s ease;
  z-index: 40;
}

body.nav-open .nav-backdrop {
  opacity: 1;
  visibility: visible;
}

/* EN: Reduced motion | RU: Уменьшенное движение */
@media (prefers-reduced-motion: reduce) {
  .skeleton,
  .img-placeholder::before {
    animation: none;
  }

  .skip-link {
    transition: none;
  }
}

/* EN: High contrast mode | RU: Режим высокой контрастности */
@media (prefers-contrast: high) {
  :focus-visible {
    outline-width: 3px;
  }

  .btn:focus-visible {
    outline-width: 3px;
  }
}

/* EN: Print styles | RU: Стили для печати */
@media print {
  .skip-link,
  .nav-backdrop,
  #themeToggle {
    display: none !important;
  }
}

/* =============================================
   CLS Prevention - Aspect Ratio & Content Hints
   Предотвращение CLS - Соотношение сторон
   ============================================= */

/* EN: Reserve space for hero images | RU: Резервирование места для hero изображений */
.photo-stack {
  aspect-ratio: 4 / 5;
  contain: layout style;
}

/* EN: Gallery items aspect ratio | RU: Соотношение сторон галереи */
.gallery__item {
  aspect-ratio: 1 / 1;
  contain: layout style paint;
}

/* EN: Blog cover images | RU: Обложки блога */
.blog-post__cover {
  aspect-ratio: 16 / 9;
  contain: layout;
}

.blog-post__cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* EN: Post cards - reserve height | RU: Карточки постов - резервирование высоты */
.post-card__image {
  aspect-ratio: 16 / 10;
  contain: layout style;
}

/* EN: Review slides | RU: Слайды отзывов */
.review-slide {
  contain: content;
}

/* =============================================
   GPU Acceleration Hints
   Подсказки для GPU ускорения
   ============================================= */

/* EN: Animated elements use GPU | RU: Анимированные элементы используют GPU */
.fade-in,
.slide-up,
.scale-in,
.blur-in {
  will-change: opacity, transform;
}

/* EN: Sakura canvas | RU: Canvas сакуры */
#sakura-canvas {
  will-change: contents;
}

/* EN: Carousel track | RU: Трек карусели */
#reviewsTrack {
  will-change: transform;
}

/* EN: Lightbox transitions | RU: Переходы лайтбокса */
.lightbox {
  will-change: opacity;
  contain: strict;
}

.lightbox img {
  will-change: transform;
}

/* EN: Remove will-change after animation ends to free memory
   RU: Удаление will-change после завершения анимации для освобождения памяти */
.fade-in.is-visible,
.slide-up.is-visible,
.scale-in.is-visible,
.blur-in.is-visible {
  will-change: auto;
}
