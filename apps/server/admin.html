<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üéå Admin Panel - Japan School</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary: #f06b93;
        --secondary: #ffc107;
        --dark: #2c3e50;
        --light: #ecf0f1;
        --success: #27ae60;
        --danger: #e74c3c;
        --info: #3498db;
      }

      body {
        font-family:
          'Inter',
          -apple-system,
          BlinkMacSystemFont,
          'Segoe UI',
          Roboto,
          Arial,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      /* Login Screen Styles */
      .login-screen {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
      }

      .login-box {
        background: white;
        border-radius: 20px;
        padding: 40px;
        max-width: 400px;
        width: 100%;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: slideInUp 0.6s ease;
      }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .login-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .login-header h1 {
        font-size: 32px;
        margin-bottom: 8px;
        color: var(--dark);
      }

      .login-header p {
        color: #7f8c8d;
        font-size: 14px;
      }

      .login-form {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .form-group label {
        font-weight: 600;
        color: var(--dark);
        font-size: 14px;
      }

      .form-group input {
        padding: 12px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 15px;
        transition: all 0.3s ease;
      }

      .form-group input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(240, 107, 147, 0.1);
      }

      .login-btn {
        padding: 14px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 10px;
      }

      .login-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      }

      .login-btn:active {
        transform: translateY(0);
      }

      .error-message {
        background: #fee;
        color: var(--danger);
        padding: 12px;
        border-radius: 8px;
        font-size: 14px;
        text-align: center;
        display: none;
        animation: shake 0.5s ease;
      }

      .error-message.show {
        display: block;
      }

      /* Inline-style replacements */
      .hint {
        margin-top: 20px;
        text-align: center;
        font-size: 12px;
        color: #7f8c8d;
      }

      .hint-code {
        background: #f0f0f0;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono', 'Courier New', monospace;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        10%,
        30%,
        50%,
        70%,
        90% {
          transform: translateX(-5px);
        }
        20%,
        40%,
        60%,
        80% {
          transform: translateX(5px);
        }
      }

      .admin-panel {
        display: none;
      }

      .admin-panel.authenticated {
        display: block;
      }

      .login-screen.hidden {
        display: none;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      .header {
        background: white;
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
      }

      .header h1 {
        color: var(--dark);
        font-size: 32px;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      }

      .stat-card h3 {
        color: #7f8c8d;
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .stat-card .value {
        font-size: 36px;
        font-weight: 700;
        color: var(--dark);
      }

      .controls {
        background: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 30px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: center;
      }

      .search-box {
        flex: 1;
        min-width: 250px;
        position: relative;
      }

      .search-box input {
        width: 100%;
        padding: 12px 16px 12px 40px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 15px;
        transition: all 0.3s ease;
      }

      .search-box input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(240, 107, 147, 0.1);
      }

      .search-box::before {
        content: 'üîç';
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 18px;
      }

      .filter-buttons {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .btn-primary {
        background: var(--primary);
        color: white;
      }

      .btn-success {
        background: var(--success);
        color: white;
      }

      .btn-info {
        background: var(--info);
        color: white;
      }

      .btn-secondary {
        background: var(--light);
        color: var(--dark);
      }

      .btn.active {
        background: var(--dark);
        color: white;
      }

      .submissions-table {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
      }

      thead th {
        padding: 16px;
        text-align: left;
        color: white;
        font-weight: 600;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      tbody tr {
        border-bottom: 1px solid #e0e0e0;
        transition: background 0.3s ease;
      }

      tbody tr:hover {
        background: #f8f9fa;
      }

      tbody td {
        padding: 16px;
        color: var(--dark);
        font-size: 14px;
      }

      .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .badge-n5 {
        background: #e3f2fd;
        color: #1976d2;
      }
      .badge-n4 {
        background: #f3e5f5;
        color: #7b1fa2;
      }
      .badge-n3 {
        background: #fff3e0;
        color: #ef6c00;
      }
      .badge-n2 {
        background: #e8f5e9;
        color: #388e3c;
      }
      .badge-n1 {
        background: #ffebee;
        color: #c62828;
      }

      .message-preview {
        max-width: 300px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .no-data {
        text-align: center;
        padding: 60px 20px;
        color: #7f8c8d;
      }

      .no-data-icon {
        font-size: 64px;
        margin-bottom: 16px;
      }

      .loading {
        text-align: center;
        padding: 60px 20px;
      }

      .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-left-color: var(--primary);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .actions {
        display: flex;
        gap: 8px;
      }

      .action-btn {
        padding: 6px 12px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.3s ease;
      }

      .action-btn:hover {
        transform: scale(1.05);
      }

      .view-btn {
        background: var(--info);
        color: white;
      }

      .delete-btn {
        background: var(--danger);
        color: white;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        padding: 20px;
        overflow-y: auto;
      }

      .modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: white;
        border-radius: 16px;
        max-width: 600px;
        width: 100%;
        padding: 32px;
        position: relative;
        animation: slideIn 0.3s ease;
      }

      @keyframes slideIn {
        from {
          transform: translateY(-50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .modal-close {
        position: absolute;
        top: 16px;
        right: 16px;
        background: none;
        border: none;
        font-size: 28px;
        cursor: pointer;
        color: #7f8c8d;
        transition: color 0.3s ease;
      }

      .modal-close:hover {
        color: var(--danger);
      }

      .modal-header {
        margin-bottom: 24px;
      }

      .modal-header h2 {
        color: var(--dark);
        margin-bottom: 8px;
      }

      .modal-body {
        color: var(--dark);
      }

      .detail-row {
        display: flex;
        padding: 12px 0;
        border-bottom: 1px solid #e0e0e0;
      }

      .detail-row:last-child {
        border-bottom: none;
      }

      .detail-label {
        font-weight: 600;
        min-width: 120px;
        color: #7f8c8d;
      }

      .detail-value {
        flex: 1;
      }

      /* ========================================
         Mobile Responsive Styles
         ======================================== */
      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        .login-box {
          padding: 30px 20px;
          max-width: 100%;
        }

        .login-header h1 {
          font-size: 28px;
        }

        .header {
          flex-direction: column;
          gap: 15px;
          text-align: center;
        }

        .header h1 {
          font-size: 24px;
        }

        .header div {
          width: 100%;
          display: flex;
          gap: 8px;
        }

        .header .btn {
          flex: 1;
          font-size: 12px;
          padding: 10px 12px;
        }

        .stats {
          grid-template-columns: 1fr 1fr;
          gap: 12px;
        }

        .stat-card {
          padding: 16px;
        }

        .stat-card .value {
          font-size: 28px;
        }

        .controls {
          flex-direction: column;
          padding: 16px;
          gap: 12px;
        }

        .search-box {
          width: 100%;
          min-width: unset;
        }

        .filters {
          width: 100%;
          flex-wrap: nowrap;
          overflow-x: auto;
        }

        .filters select {
          min-width: 120px;
        }

        .submissions-table {
          padding: 12px;
          overflow-x: auto;
        }

        table {
          font-size: 11px;
          min-width: 600px;
        }

        thead th {
          padding: 10px 6px;
          font-size: 11px;
        }

        tbody td {
          padding: 10px 6px;
        }

        .status-badge {
          font-size: 10px;
          padding: 3px 6px;
        }

        .btn-small {
          padding: 6px 10px;
          font-size: 11px;
        }

        .modal-content {
          padding: 20px;
          margin: 10px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .modal-header h2 {
          font-size: 20px;
        }

        .detail-group {
          padding: 12px;
        }
      }

      @media (max-width: 480px) {
        .stats {
          grid-template-columns: 1fr;
        }

        .header div {
          flex-direction: column;
        }

        .header .btn {
          width: 100%;
        }

        .stat-card h3 {
          font-size: 12px;
        }

        .stat-card .value {
          font-size: 24px;
        }

        table {
          font-size: 10px;
        }

        .btn-small {
          padding: 5px 8px;
          font-size: 10px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
      <div class="login-box">
        <div class="login-header">
          <h1>üéå Admin Login</h1>
          <p>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</p>
        </div>
        <form class="login-form" onsubmit="handleLogin(event)">
          <div class="error-message" id="errorMessage">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.</div>
          <div class="form-group">
            <label for="password">–ü–∞—Ä–æ–ª—å</label>
            <input
              type="password"
              id="password"
              placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
              required
              autocomplete="current-password"
            />
          </div>
          <button type="submit" class="login-btn">–í–æ–π—Ç–∏</button>
        </form>
        <div class="hint">
          <p>
            üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ø–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            <code class="hint-code">admin123</code>
          </p>
        </div>
      </div>
    </div>

    <!-- Admin Panel (hidden until authenticated) -->
    <div class="admin-panel" id="adminPanel">
      <div class="container">
        <!-- Header -->
        <div class="header">
          <h1>
            <span>üéå</span>
            <span>Admin Panel</span>
          </h1>
          <div>
            <button class="btn btn-primary" onclick="refreshData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            <button class="btn btn-success" onclick="exportToCSV()">üì• –≠–∫—Å–ø–æ—Ä—Ç CSV</button>
            <button class="btn btn-secondary" onclick="logout()">üö™ –í—ã—Ö–æ–¥</button>
          </div>
        </div>

        <!-- Statistics -->
        <div class="stats">
          <div class="stat-card">
            <h3>–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</h3>
            <div class="value" id="totalSubmissions">0</div>
          </div>
          <div class="stat-card">
            <h3>–ó–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
            <div class="value" id="todaySubmissions">0</div>
          </div>
          <div class="stat-card">
            <h3>–ó–∞ –Ω–µ–¥–µ–ª—é</h3>
            <div class="value" id="weekSubmissions">0</div>
          </div>
          <div class="stat-card">
            <h3>–ó–∞ –º–µ—Å—è—Ü</h3>
            <div class="value" id="monthSubmissions">0</div>
          </div>
        </div>

        <!-- Controls -->
        <div class="controls">
          <div class="search-box">
            <input
              type="text"
              id="searchInput"
              placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, email, —Ç–µ–ª–µ—Ñ–æ–Ω—É..."
              oninput="filterSubmissions()"
            />
          </div>
          <div class="filter-buttons">
            <button class="btn btn-secondary active" data-filter="all" onclick="setFilter('all')">–í—Å–µ</button>
            <button class="btn btn-secondary" data-filter="N5" onclick="setFilter('N5')">N5</button>
            <button class="btn btn-secondary" data-filter="N4" onclick="setFilter('N4')">N4</button>
            <button class="btn btn-secondary" data-filter="N3" onclick="setFilter('N3')">N3</button>
            <button class="btn btn-secondary" data-filter="N2" onclick="setFilter('N2')">N2</button>
            <button class="btn btn-secondary" data-filter="N1" onclick="setFilter('N1')">N1</button>
          </div>
        </div>

        <!-- Submissions Table -->
        <div class="submissions-table">
          <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
          </div>
          <div id="tableContainer"></div>
        </div>
      </div>

      <!-- Modal -->
      <div class="modal" id="detailModal">
        <div class="modal-content">
          <button class="modal-close" onclick="closeModal()">&times;</button>
          <div class="modal-header">
            <h2>–î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏</h2>
          </div>
          <div class="modal-body" id="modalBody">
            <!-- Content will be inserted here -->
          </div>
        </div>
      </div>
    </div>
    <!-- end admin-panel -->

    <script>
      const API_BASE = 'http://localhost:3000';
      let allSubmissions = [];
      let currentFilter = 'all';

      // Note: loadSubmissions() called from authentication handler below
      async function loadSubmissions() {
        try {
          const response = await fetch(`${API_BASE}/api/submissions`);
          const data = await response.json();

          if (data.success) {
            allSubmissions = data.data;
            updateStatistics();
            renderTable();
          } else {
            showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ');
          }
        } catch (error) {
          showError('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
        } finally {
          document.getElementById('loading').style.display = 'none';
        }
      }

      function updateStatistics() {
        const now = new Date();
        const today = now.toDateString();
        const weekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);
        const monthAgo = new Date(now - 30 * 24 * 60 * 60 * 1000);

        document.getElementById('totalSubmissions').textContent = allSubmissions.length;

        document.getElementById('todaySubmissions').textContent = allSubmissions.filter(
          (s) => new Date(s.timestamp).toDateString() === today
        ).length;

        document.getElementById('weekSubmissions').textContent = allSubmissions.filter(
          (s) => new Date(s.timestamp) >= weekAgo
        ).length;

        document.getElementById('monthSubmissions').textContent = allSubmissions.filter(
          (s) => new Date(s.timestamp) >= monthAgo
        ).length;
      }

      function renderTable() {
        const filtered = getFilteredSubmissions();
        const container = document.getElementById('tableContainer');

        if (filtered.length === 0) {
          container.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-icon">üì≠</div>
                        <h3>–ó–∞—è–≤–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>
                    </div>
                `;
          return;
        }

        const tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–ò–º—è</th>
                            <th>Email</th>
                            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                            <th>–£—Ä–æ–≤–µ–Ω—å</th>
                            <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filtered
                          .map(
                            (submission) => `
                            <tr>
                                <td>${formatDate(submission.timestamp)}</td>
                                <td><strong>${submission.name}</strong></td>
                                <td>${submission.email}</td>
                                <td>${submission.phone}</td>
                                <td><span class="badge badge-${submission.level?.toLowerCase() || 'n5'}">${submission.level || 'N/A'}</span></td>
                                <td><div class="message-preview">${submission.message || '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è'}</div></td>
                                <td>
                                    <div class="actions">
                                        <button class="action-btn view-btn" onclick='viewDetails(${JSON.stringify(submission).replace(/'/g, "\\'")})'>
                                            üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `
                          )
                          .join('')}
                    </tbody>
                </table>
            `;

        container.innerHTML = tableHTML;
      }

      function getFilteredSubmissions() {
        let filtered = allSubmissions;

        // Filter by level
        if (currentFilter !== 'all') {
          filtered = filtered.filter((s) => s.level === currentFilter);
        }

        // Filter by search
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        if (searchTerm) {
          filtered = filtered.filter(
            (s) =>
              s.name.toLowerCase().includes(searchTerm) ||
              s.email.toLowerCase().includes(searchTerm) ||
              s.phone.includes(searchTerm) ||
              (s.message && s.message.toLowerCase().includes(searchTerm))
          );
        }

        return filtered;
      }

      function setFilter(filter) {
        currentFilter = filter;

        // Update button states
        document.querySelectorAll('[data-filter]').forEach((btn) => {
          btn.classList.toggle('active', btn.dataset.filter === filter);
        });

        renderTable();
      }

      function filterSubmissions() {
        renderTable();
      }

      function viewDetails(submission) {
        const modal = document.getElementById('detailModal');
        const body = document.getElementById('modalBody');

        body.innerHTML = `
                <div class="detail-row">
                    <div class="detail-label">üìÖ –î–∞—Ç–∞:</div>
                    <div class="detail-value">${formatDateTime(submission.timestamp)}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">üë§ –ò–º—è:</div>
                    <div class="detail-value"><strong>${submission.name}</strong></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">üìß Email:</div>
                    <div class="detail-value"><a href="mailto:${submission.email}">${submission.email}</a></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">üì± –¢–µ–ª–µ—Ñ–æ–Ω:</div>
                    <div class="detail-value"><a href="tel:${submission.phone}">${submission.phone}</a></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">üìä –£—Ä–æ–≤–µ–Ω—å:</div>
                    <div class="detail-value"><span class="badge badge-${submission.level?.toLowerCase() || 'n5'}">${submission.level || 'N/A'}</span></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">üìù –¢–∏–ø —Ñ–æ—Ä–º—ã:</div>
                    <div class="detail-value">${submission.formType === 'hero' ? 'Hero —Å–µ–∫—Ü–∏—è' : '–ö–æ–Ω—Ç–∞–∫—Ç—ã'}</div>
                </div>
                ${
                  submission.message
                    ? `
                <div class="detail-row">
                    <div class="detail-label">üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ:</div>
                    <div class="detail-value" style="white-space: pre-wrap;">${submission.message}</div>
                </div>
                `
                    : ''
                }
            `;

        modal.classList.add('active');
      }

      function closeModal() {
        document.getElementById('detailModal').classList.remove('active');
      }

      function refreshData() {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('tableContainer').innerHTML = '';
        loadSubmissions();
      }

      function exportToCSV() {
        const filtered = getFilteredSubmissions();

        if (filtered.length === 0) {
          alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
          return;
        }

        const headers = ['–î–∞—Ç–∞', '–ò–º—è', 'Email', '–¢–µ–ª–µ—Ñ–æ–Ω', '–£—Ä–æ–≤–µ–Ω—å', '–¢–∏–ø —Ñ–æ—Ä–º—ã', '–°–æ–æ–±—â–µ–Ω–∏–µ'];
        const rows = filtered.map((s) => [
          formatDateTime(s.timestamp),
          s.name,
          s.email,
          s.phone,
          s.level || 'N/A',
          s.formType === 'hero' ? 'Hero' : '–ö–æ–Ω—Ç–∞–∫—Ç—ã',
          (s.message || '').replace(/"/g, '""')
        ]);

        const csv = [headers.join(','), ...rows.map((row) => row.map((cell) => `"${cell}"`).join(','))].join('\n');

        const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `submissions_${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
      }

      function formatDate(timestamp) {
        return new Date(timestamp).toLocaleDateString('ru-RU', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric'
        });
      }

      function formatDateTime(timestamp) {
        return new Date(timestamp).toLocaleString('ru-RU', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
      }

      function showError(message) {
        document.getElementById('tableContainer').innerHTML = `
                <div class="no-data">
                    <div class="no-data-icon">‚ö†Ô∏è</div>
                    <h3>–û—à–∏–±–∫–∞</h3>
                    <p>${message}</p>
                </div>
            `;
      }

      // Close modal on outside click
      document.getElementById('detailModal').addEventListener('click', (e) => {
        if (e.target.id === 'detailModal') {
          closeModal();
        }
      });

      /* ===== Login Authentication ===== */
      const ADMIN_PASSWORD = 'admin123'; // Change this in production!

      function handleLogin(event) {
        event.preventDefault();

        const password = document.getElementById('password').value;
        const errorMessage = document.getElementById('errorMessage');

        if (password === ADMIN_PASSWORD) {
          // Store authentication in sessionStorage
          sessionStorage.setItem('adminAuthenticated', 'true');

          // Show admin panel
          document.getElementById('loginScreen').classList.add('hidden');
          document.getElementById('adminPanel').classList.add('authenticated');

          // Load data
          loadSubmissions();
        } else {
          // Show error
          errorMessage.classList.add('show');
          document.getElementById('password').value = '';
          document.getElementById('password').focus();

          // Hide error after 3 seconds
          setTimeout(() => {
            errorMessage.classList.remove('show');
          }, 3000);
        }
      }

      // Check if already authenticated
      window.addEventListener('DOMContentLoaded', () => {
        if (sessionStorage.getItem('adminAuthenticated') === 'true') {
          document.getElementById('loginScreen').classList.add('hidden');
          document.getElementById('adminPanel').classList.add('authenticated');
          loadSubmissions();
        }
      });

      // Logout function (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ header)
      function logout() {
        sessionStorage.removeItem('adminAuthenticated');
        document.getElementById('loginScreen').classList.remove('hidden');
        document.getElementById('adminPanel').classList.remove('authenticated');
        document.getElementById('password').value = '';
      }
    </script>
  </body>
</html>
